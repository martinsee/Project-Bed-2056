---
title: "USA vs Kina"
author: "Martin S. Bjørnerem og  Chris A. Stokvik"
date: "12/9/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(readxl)
library(lubridate)
library(mosaic)
library(tsibble)
library(tidyquant)
library(corrplot)

```




```{r cars}

cod <- ("2002-02-03")

## Oil wti 

oilwti <- read_csv("data/Crude Oil WTI Futures Historical Data.csv", 
                   col_types = cols(Date = col_date(format = "%b %d, %Y")))

oilwti <- oilwti %>%
  select(Date, Price) %>%
  filter(Date >= as.Date(cod))


## USA 3m Bond rate

usa3m <- read_csv("data/United States 3-Month Bond Yield Historical Data.csv", 
                  col_types = cols(Date = col_date(format = "%b %d, %Y")))

usa3m <- usa3m %>%
  select(Date, Price) %>%
  filter(Date >= as.Date(cod))



## SP500 aksje indeks 
sp500 <- read_csv("data/^GSPC.csv", col_types = cols(Date = col_date(format = "%Y-%m-%d")))

sp500 <- sp500 %>%  
  select(Date, Close) %>%
  filter(Date >= as.Date(cod))


## Shanghai
shanghai <- read_csv("data/Shanghai Composite Historical Data.csv", 
                                               col_types = cols(Date = col_date(format = "%b %d, %Y"), 
                                                                Price = col_number()))

shanghai <- shanghai %>%
  select(Date, Price) %>%
  filter(Date >= as.Date(cod))



## China 1Y Bond 
china_1y <- read_csv("data/China 1-Year Bond Yield Historical Data.csv", 
                                                    col_types = cols(Date = col_date(format = "%b %d, %Y")))

china_1y <- china_1y %>%
  select(Date, Price) %>%
  filter(Date >= as.Date(cod))

## Bitcoin 
bitcoin_day <- read_csv("data/BTC_USD Bitfinex Historical Data.csv", 
                        col_types = cols(Date = col_date(format = "%b %d, %Y")))

bitcoin_day <- bitcoin_day %>%
  select(Date, Price) %>%
  rename(Close = "Price") %>%
  filter(Date >= as.Date(cod))  




#### Felles datasett 
UC <- china_1y %>%
  full_join(sp500, by = "Date") %>% 
  full_join(oilwti, by = "Date") %>%
  full_join(usa3m, by = "Date") %>%
  full_join(shanghai, by = "Date") %>%
  full_join(bitcoin_day, by = "Date") %>% 
  rename(china_bond = "Price.x", sp500 = "Close.x", oilwti = "Price.y", usa_bond = "Price.x.x", shanghai = "Price.y.y",
         Bitcoin = "Close.y") %>% 
      na.omit()

```



```{r pressure, echo=FALSE}

UC_long  <- UC %>% 
  filter(Bitcoin > 0.0001 & usa_bond > 0.0001) %>% 
  select(Date, china_bond, sp500, oilwti, usa_bond, shanghai, Bitcoin) %>%
  gather(key= "asset", value = "Close", -Date)

## Lage plot 

ggplot(UC_long, aes(x=Date, y=Close, col=asset ))+
  geom_line()+
  scale_y_log10(name = "Close")+
  ggtitle("USA og Kina") 

```

```{r}

UC_cor  <- UC %>% 
  select(china_bond, sp500, oilwti, usa_bond, shanghai, Bitcoin)

res <- cor(UC_cor)
round(res, 2)

corrplot(res, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

```
Bitcoin datasette går tilbake til 2013. Det gjør at tidshorisonten blir begrenset når en business cickle gjerne er i x år. (sett inn kilde ) 

Vi har derfor laget et til datasett med de dataene som er over lengre tid for å kunne analysere korrelasjoner helt tilbake til 2001. 

```{r}

UC_u <- china_1y %>%
  full_join(oilwti, by = "Date") %>%
  full_join(sp500, by = "Date") %>% 
  full_join(usa3m, by = "Date") %>%
  full_join(shanghai, by = "Date")%>%
  rename( china_bond = "Price.x",  oilwti = "Price.y", sp500 = "Close", usa_bond = "Price.x.x", shanghai = "Price.y.y") %>% 
  na.omit()


UC_u_long  <- UC_u %>% 
  filter(usa_bond > 0.0001) %>% 
  select(Date, china_bond, sp500, oilwti,  usa_bond, shanghai) %>%
  gather(key= "asset", value = "Close", -Date)

## Lage plot 

ggplot(UC_u_long, aes(x=Date, y=Close, col=asset ))+
  geom_line()+
  scale_y_log10(name = "Close")+
  ggtitle("USA og Kina") 


UC_u_cor  <- UC_u %>% 
  select(china_bond, sp500, oilwti, usa_bond, shanghai)

res2 <- cor(UC_u_cor)
round(res2, 2)

corrplot(res2, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

```

Vi ser her at korrelasjonene er mye svakere når tidshorisonten øker. Vi ønsker dermed å se på differansen i korrelasjon når vi har forskjellige lenge på dataen ved å lage en differanse korrelasjon matrix.  


```{r}

res

res2

res4

res3 <- res[c(1, 2, 3, 4, 5), c(1, 2, 3, 4, 5)]

res4 <- res3 - res2 

corrplot(res4, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```

Vi ser her at tre korrelasjonene utmerket seg med stor differanse ut fra hvor lang tidshorisont dataen hadde. 


SP500 indeksen og USA  3-month treasury bonds gikk fra å ha en korrelasjon på  0.87 til -0.08

```{r}
sp_bond <- lm(sp500~usa_bond, data = UC_u)
summary(sp_bond)
plotModel(sp_bond)

```
```{r}
ggplot(UC_u, aes(x = sp500, y = usa_bond, col = Date)) +
  geom_point()

```




I det korte intervallet var det -0.77  til 0.22 i det lange 

```{r}
oil_shang <- lm(oilwti~shanghai, data = UC_u)
summary(oil_shang)
plotModel(oil_shang)

```




```{r}
bond_shang <- lm(shanghai~china_bond, data = UC_u)
summary(bond_shang)
plotModel(bond_shang)

```





#Vi ser på de mørkeste priskkene som er før 2005 lå rentene å beveget seg mellom 2-3% og og markedet lå på rundt 1500.

#Så startet børsen å gå kraftig opp, og renten gikk opp til å ligge mellom 3-4 prosent noe som er i samsvar med øknomisk teori om #at oppgangstider vil etterspørselen på kapital gå opp og dermed vil prisen man må betale for å få kapital øke. 


```{r}
ggplot(UC_u, aes(x = china_bond, y = shanghai, col = Date)) +
  geom_point()
```

